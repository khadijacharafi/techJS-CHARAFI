<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Book Reading Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- En-t√™te -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üìö Book Reading Tracker</h1>
            <p class="text-gray-600">Suivez votre progression de lecture</p>
        </header>

        <!-- Statistiques globales -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <p class="text-gray-600 text-sm mb-1">Livres termin√©s</p>
                <p class="text-3xl font-bold text-green-600" id="totalBooksRead">0</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <p class="text-gray-600 text-sm mb-1">Total de pages lues</p>
                <p class="text-3xl font-bold text-blue-600" id="totalPagesRead">0</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <p class="text-gray-600 text-sm mb-1">Livres en cours</p>
                <p class="text-3xl font-bold text-orange-600" id="totalBooksInProgress">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Formulaire d'ajout de livre -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-lg shadow-md sticky top-4">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">‚ûï Ajouter un livre</h2>
                    <form id="bookForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Titre *</label>
                            <input type="text" id="title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Auteur *</label>
                            <input type="text" id="author" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de pages *</label>
                            <input type="number" id="numberOfPages" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pages lues</label>
                            <input type="number" id="pagesRead" value="0" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Statut *</label>
                            <select id="status" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="Want to read">Want to read</option>
                                <option value="Currently reading">Currently reading</option>
                                <option value="Read">Read</option>
                                <option value="Re-read">Re-read</option>
                                <option value="DNF">DNF</option>
                                <option value="Returned Unread">Returned Unread</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Format *</label>
                            <select id="format" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="Print">Print</option>
                                <option value="PDF">PDF</option>
                                <option value="Ebook">Ebook</option>
                                <option value="AudioBook">AudioBook</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Prix (DH)</label>
                            <input type="number" id="price" value="0" min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sugg√©r√© par</label>
                            <input type="text" id="suggestedBy" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors font-medium">
                            Ajouter le livre
                        </button>
                    </form>
                </div>
            </div>

            <!-- Liste des livres -->
            <div class="lg:col-span-2">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">üìñ Ma biblioth√®que</h2>
                    <div id="booksList" class="space-y-4">
                        <!-- Les livres seront affich√©s ici -->
                        <p class="text-gray-500 text-center py-8">Aucun livre pour le moment. Ajoutez-en un !</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Classe Book (version simplifi√©e pour le navigateur)
        class Book {
            constructor(data) {
                this._id = data._id;
                this.title = data.title;
                this.author = data.author;
                this.numberOfPages = data.numberOfPages;
                this.status = data.status;
                this.price = data.price;
                this.pagesRead = Math.min(data.pagesRead, data.numberOfPages);
                this.format = data.format;
                this.suggestedBy = data.suggestedBy || '';
                this.finished = this.pagesRead >= this.numberOfPages;
            }

            currentlyAt() {
                if (this.numberOfPages === 0) return 0;
                return Math.round((this.pagesRead / this.numberOfPages) * 100);
            }

            deleteBook() {
                return this._id;
            }
        }

        // API Service (simul√© en local avec localStorage)
        class BookAPI {
            static STORAGE_KEY = 'booktracker_books';

            static async getAllBooks() {
                const data = localStorage.getItem(this.STORAGE_KEY);
                const books = data ? JSON.parse(data) : [];
                return books.map(b => new Book(b));
            }

            static async addBook(bookData) {
                const books = await this.getAllBooks();
                const newBook = {
                    ...bookData,
                    _id: Date.now().toString(),
                    finished: bookData.pagesRead >= bookData.numberOfPages
                };
                books.push(newBook);
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(books.map(b => ({ ...b }))));
                return new Book(newBook);
            }

            static async deleteBook(id) {
                let books = await this.getAllBooks();
                books = books.filter(b => b._id !== id);
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(books.map(b => ({ ...b }))));
                return true;
            }

            static async updateBook(id, updates) {
                let books = await this.getAllBooks();
                const index = books.findIndex(b => b._id === id);
                if (index !== -1) {
                    books[index] = { ...books[index], ...updates };
                    books[index].finished = books[index].pagesRead >= books[index].numberOfPages;
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(books.map(b => ({ ...b }))));
                    return new Book(books[index]);
                }
                return null;
            }
        }

        // Application
        let books = [];

        // Charger les livres
        async function loadBooks() {
            books = await BookAPI.getAllBooks();
            displayBooks();
            updateStats();
        }

        // Afficher les livres
        function displayBooks() {
            const booksList = document.getElementById('booksList');
            
            if (books.length === 0) {
                booksList.innerHTML = '<p class="text-gray-500 text-center py-8">Aucun livre pour le moment. Ajoutez-en un !</p>';
                return;
            }

            booksList.innerHTML = books.map(book => {
                const percentage = book.currentlyAt();
                const statusColors = {
                    'Read': 'bg-green-100 text-green-800',
                    'Re-read': 'bg-blue-100 text-blue-800',
                    'DNF': 'bg-red-100 text-red-800',
                    'Currently reading': 'bg-orange-100 text-orange-800',
                    'Returned Unread': 'bg-gray-100 text-gray-800',
                    'Want to read': 'bg-purple-100 text-purple-800'
                };

                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg text-gray-800">${book.title}</h3>
                                <p class="text-gray-600 text-sm">par ${book.author}</p>
                                ${book.suggestedBy ? `<p class="text-gray-500 text-xs mt-1">Sugg√©r√© par: ${book.suggestedBy}</p>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="deleteBookHandler('${book._id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[book.status]}">
                                ${book.status}
                            </span>
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                ${book.format}
                            </span>
                            ${book.finished ? '<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">‚úì Termin√©</span>' : ''}
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>${book.pagesRead} / ${book.numberOfPages} pages</span>
                                <span class="font-medium">${percentage}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
                            </div>
                        </div>

                        ${book.price > 0 ? `<p class="text-gray-600 text-sm mt-2">Prix: ${book.price.toFixed(2)} ‚Ç¨</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            const finishedBooks = books.filter(b => b.finished).length;
            const totalPages = books.reduce((sum, b) => sum + b.pagesRead, 0);
            const inProgress = books.filter(b => b.status === 'Currently reading').length;

            document.getElementById('totalBooksRead').textContent = finishedBooks;
            document.getElementById('totalPagesRead').textContent = totalPages.toLocaleString();
            document.getElementById('totalBooksInProgress').textContent = inProgress;
        }

        // G√©rer la soumission du formulaire
        document.getElementById('bookForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const bookData = {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                numberOfPages: parseInt(document.getElementById('numberOfPages').value),
                pagesRead: parseInt(document.getElementById('pagesRead').value),
                status: document.getElementById('status').value,
                format: document.getElementById('format').value,
                price: parseFloat(document.getElementById('price').value),
                suggestedBy: document.getElementById('suggestedBy').value
            };

            await BookAPI.addBook(bookData);
            await loadBooks();
            e.target.reset();
        });

        // Supprimer un livre
        window.deleteBookHandler = async function(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce livre ?')) {
                await BookAPI.deleteBook(id);
                await loadBooks();
            }
        };

        // Charger les livres au d√©marrage
        loadBooks();
    </script>
</body>
</html>